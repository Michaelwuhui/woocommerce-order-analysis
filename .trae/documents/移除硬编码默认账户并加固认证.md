## 背景
- 同步实现位于 `src/app/api/sync/route.ts`，使用 NextAuth 会话与 Supabase 存储；另有脚本 `test-sync.js` 可直接运行并写入 Supabase。
- 同步依赖站点配置：`sites` 表中的 `woo_url`、`consumer_key`、`consumer_secret`。

## 方法A：使用脚本直接同步（无需登录）
1. 确认 Supabase 连接可用（脚本已硬编码 URL/Service Role Key，`test-sync.js:3–6`）。
2. 在 Supabase `sites` 表确保目标站点存在并包含 `woo_url/consumer_key/consumer_secret`（脚本按名称查找 `strefa`，`test-sync.js:12–16`）。
3. 运行 `node test-sync.js` 拉取最近 5 条订单并写入：`orders`、`sync_logs`，同时更新 `sites.last_sync`（`test-sync.js:35–41, 43–52, 116–137`）。
4. 验证结果：检查 `sync_logs` 最新记录与 `orders` 新增数量，并查看日志输出的同步统计。

## 方法B：调用后端 API 同步（需登录）
1. 启动 Next.js 服务并通过 `/auth/signin` 使用 NextAuth 登录（API 授权使用 `getServerSession(authOptions)`，`src/app/api/sync/route.ts:9–12`）。
2. 通过页面或直接向 `POST /api/sync` 发送 `{ siteId }`，服务端将：读取站点、连接 WooCommerce、抓取订单并写入 Supabase（`src/app/api/sync/route.ts:23–52, 57–93`）。
3. 验证：`GET /api/sync?siteId=...` 查看同步日志（`src/app/api/sync/route.ts:134–145`）。

## 与“暂不配置 Supabase 登录”的兼容
- 若不使用 NextAuth/Supabase 登录，优先采用方法A（脚本方式），其不依赖前端登录即可完成一次性同步。
- 如果希望通过后台页面触发同步但不配置 NextAuth，我们需要改造 `src/app/api/sync/route.ts` 使用 `simple-auth` 或临时放宽授权（提出改造方案后再执行）。

## 需要的信息
- 目标站点的标识（名称或 `siteId`）；若使用脚本默认查找 `strefa`。
- `woo_url`、`consumer_key`、`consumer_secret` 是否已在 `sites` 表中配置。
- 是否允许使用现有 Supabase 连接完成本次同步，还是先改造为无 Supabase 登录的后台触发。